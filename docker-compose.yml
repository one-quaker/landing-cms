version: '3.7'

services:
    db:
        image: postgres:10.7
        env_file:
            - app_env/db
        environment:
            - PGDATA=/var/lib/postgresql/data
        volumes:
            - ./db:/var/lib/postgresql/data

    web-app:
        env_file:
            - app_env/db
        environment:
            - DEBUG=${DEBUG}
            - ALLOWED_HOSTS=${ALLOWED_HOSTS}
        image: onepycoder/landing_cms:1.05
        entrypoint: ['/bin/bash', '/entrypoint.sh', 'landing_cms']
        volumes:
            - ./src:/python_app
        ports:
            - '127.0.0.1:8100:8000'
        depends_on:
            - db
        restart: always
